(this["webpackJsonpsarafan-app"]=this["webpackJsonpsarafan-app"]||[]).push([[0],{38:function(e,t,n){e.exports=n(51)},43:function(e,t,n){},48:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(25),s=n.n(c);n(43),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=n(17),o=n(8),u=n(9),p=n(12),h=n(11),l=n(13),b=n(23),f=n(18),d=(n(48),function(e){function t(){return Object(o.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"navigation"},r.a.createElement("div",{className:"content_container"},r.a.createElement("span",{className:"logo"},r.a.createElement(b.b,{to:"/"},"Sarafan")),r.a.createElement(b.b,{to:"/new"},"new post")))}}]),t}(r.a.Component)),m=function(e){function t(){return Object(o.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"feed_post"},r.a.createElement("h1",null,"Post ",this.props.post.magnet," title"),r.a.createElement("p",null,"Post content: ",this.props.post.content))}}]),t}(r.a.Component),v=function(e){function t(){return Object(o.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"feed"},this.props.publications.map((function(e,t){return r.a.createElement(m,{key:t,post:e})})))}}]),t}(r.a.Component),O=Object(i.b)((function(e){return{publications:e.publications}}),(function(e){return{}}))(v),j=n(21),y=n(20);function E(e){return{type:"FEED_FETCH_REQUESTED",cursor:e}}function x(e){return{type:"UPDATE_CURSOR",cursor:e}}var k=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(p.a)(this,Object(h.a)(t).call(this,e))).state={text:"",privateKey:"",estimated:!1},n.handleTextChange=n.handleTextChange.bind(Object(y.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(y.a)(n)),n.handleKeyChange=n.handleKeyChange.bind(Object(y.a)(n)),n}return Object(l.a)(t,e),Object(u.a)(t,[{key:"handleTextChange",value:function(e){this.setState(Object(j.a)({},this.state,{text:e.target.value,estimated:!1}))}},{key:"handleKeyChange",value:function(e){this.setState(Object(j.a)({},this.state,{privateKey:e.target.value}))}},{key:"handleSubmit",value:function(e){this.state.estimated?this.props.publish():(this.props.createPost(this.state.text,this.state.privateKey),this.setState(Object(j.a)({},this.state,{estimated:!0}))),e.preventDefault()}},{key:"render",value:function(){return r.a.createElement("div",{id:"new_post_form"},r.a.createElement("form",{action:"/api/create_post",method:"post",onSubmit:this.handleSubmit},r.a.createElement("p",null,"Create new post from markdown:"),r.a.createElement("textarea",{name:"text",onChange:this.handleTextChange}),r.a.createElement("p",null,"Private key to use:"),r.a.createElement("textarea",{name:"private_key",onChange:this.handleKeyChange}),r.a.createElement("p",null,r.a.createElement("input",{type:"submit"}))))}}]),t}(r.a.Component),w=Object(i.b)((function(e){return{}}),(function(e){return{createPost:function(t,n){return e(function(e,t){return{type:"CREATE_POST_REQUESTED",text:e,privateKey:t}}(t,n))},publish:function(){return e({type:"PUBLISH_ESTIMATED_POST"})}}}))(k),g=function(e){function t(){return Object(o.a)(this,t),Object(p.a)(this,Object(h.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(u.a)(t,[{key:"refreshFeed",value:function(){this.props.ended||this.props.dispatch(E(this.props.cursor))}},{key:"componentDidMount",value:function(){this.props.dispatch(E(this.props.cursor))}},{key:"render",value:function(){return r.a.createElement(b.a,null,r.a.createElement(d,null),r.a.createElement("div",{className:"content_container"},r.a.createElement(f.c,null,r.a.createElement(f.a,{path:"/new"},r.a.createElement(w,null)),r.a.createElement(f.a,{path:"/"},r.a.createElement(O,null),r.a.createElement("button",{onClick:this.refreshFeed.bind(this)},"refresh")))))}}]),t}(r.a.Component),S=Object(i.b)((function(e){return{cursor:e.uiState.cursor,ended:e.uiState.ended}}))(g),C=n(16),_=n(36);var T=Object(C.c)({publications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ADD_PUBLICATION":return[].concat(Object(_.a)(e),[{magnet:t.magnet,content:t.content}]);default:return e}},uiState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"UPDATE_CURSOR":var n=!t.cursor;return Object(j.a)({},e,{cursor:t.cursor,ended:n});default:return e}}}),P=n(37),D=n(5),K=n.n(D),U=n(15),R=n(24),A=new(function(){function e(t){Object(o.a)(this,e),console.log("Start with backend",t),this.backend_url=t,this.fetchPosts=this.fetchPosts.bind(this),this.createPost=this.createPost.bind(this),this.publishPost=this.publishPost.bind(this),this.authenticate=this.authenticate.bind(this)}return Object(u.a)(e,[{key:"fetchPosts",value:function(){var e=Object(R.a)(K.a.mark((function e(t){var n,a,r;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.backend_url+"api/posts",t&&(n+="?cursor="+t),e.next=4,fetch(n,{method:"GET"});case 4:return a=e.sent,e.next=7,a.json();case 7:return r=e.sent,e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createPost",value:function(){var e=Object(R.a)(K.a.mark((function e(t,n){var a,r;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={text:t,privateKey:n},e.next=3,fetch(this.backend_url+"api/create_post",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"publishPost",value:function(){var e=Object(R.a)(K.a.mark((function e(t,n){var a,r;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={magnet:t,privateKey:n},e.next=3,fetch(this.backend_url+"api/publish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});case 3:return r=e.sent,e.next=6,r.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authenticate",value:function(){var e=Object(R.a)(K.a.mark((function e(t){var n,a;return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={private_key:t},e.next=3,fetch(this.backend_url+"api/authenticate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 3:return a=e.sent,e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}())("/"),N=K.a.mark(Q),F=K.a.mark(H),I=K.a.mark(L),J=K.a.mark(M),B=K.a.mark(W);function Q(e){var t,n,a,r,c,s,i,o;return K.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return t=e.cursor,u.next=3,Object(U.b)(A.fetchPosts,t);case 3:n=u.sent,a=!0,r=!1,c=void 0,u.prev=7,s=n.result[Symbol.iterator]();case 9:if(a=(i=s.next()).done){u.next=16;break}return o=i.value,u.next=13,Object(U.c)((p=o.magnet,h=o.content,{type:"ADD_PUBLICATION",magnet:p,content:h}));case 13:a=!0,u.next=9;break;case 16:u.next=22;break;case 18:u.prev=18,u.t0=u.catch(7),r=!0,c=u.t0;case 22:u.prev=22,u.prev=23,a||null==s.return||s.return();case 25:if(u.prev=25,!r){u.next=28;break}throw c;case 28:return u.finish(25);case 29:return u.finish(22);case 30:return u.next=32,Object(U.c)(x(n.next_cursor));case 32:case"end":return u.stop()}var p,h}),N,null,[[7,18,22,30],[23,,25,29]])}function H(e,t){var n;return K.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(U.b)(A.createPost,e.text,e.privateKey);case 2:n=t.sent,console.log("Created post",n);case 4:case"end":return t.stop()}}),F)}function L(){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(U.e)("FEED_FETCH_REQUESTED",Q);case 2:case"end":return e.stop()}}),I)}function M(){return K.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(U.e)("CREATE_POST_REQUESTED",H);case 2:case"end":return e.stop()}}),J)}function W(){var e;return K.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=[L,M],t.next=3,Object(U.a)(e.map((function(e){return Object(U.d)(K.a.mark((function t(){return K.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=1,t.next=4,Object(U.b)(e);case 4:return t.abrupt("break",12);case 7:t.prev=7,t.t0=t.catch(1),console.log(t.t0);case 10:t.next=0;break;case 12:case"end":return t.stop()}}),t,null,[[1,7]])})))})));case 3:case"end":return t.stop()}}),B)}var q=Object(P.a)(),G=Object(C.e)(T,Object(C.a)(q));q.run(W),s.a.render(r.a.createElement(i.a,{store:G},r.a.createElement(S,null)),document.querySelector("#root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[38,1,2]]]);
//# sourceMappingURL=main.61b494cd.chunk.js.map